<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="js/jquery.form.min.js"></script>
    <script src="js/navigator.sayswho.js" type="text/javascript"></script>
</head>
<body>
<div class="bar">


</div><div class="percent"></div>
<div id="status"></div>
<form id="myForm" action="/ajaxservice/fileuploadergenic.ashx" method="post"> 
      <input type="file" name="files[]" multiple class="fi" /> 
    
    <input type="submit" value="Submit Comment" /> 
</form>
</body>
<script type="text/javascript">

    $(function () {

        var bar = $('.bar');
        var percent = $('.percent');
        var status = $('#status');

        $('form').ajaxForm({
            beforeSend: function () {
                status.empty();
                var percentVal = '0%';
                bar.width(percentVal);
                percent.html(percentVal);
            },
            uploadProgress: function (event, position, total, percentComplete) {
                var percentVal = percentComplete + '%';
                bar.width(percentVal);
                percent.html(percentVal);
            },
            complete: function (xhr) {
                status.html(xhr.responseText);
            }
        });
        var canMultiple = true;
        var who = navigator.sayswho.split(" ");
        
        if (who[0].indexOf("IE")>=0 && parseInt(who[1]) < 10) {
            canMultiple = false;
        }

        $(".fi").on("change", function (e) {

            if (canMultiple) {
                return false;
            }
            //如果是最后一个,不需要添加控件
            if ($(".fi").length > 1 && $(this).index('.fi') < $(".fi").length - 1) {
                return false;
            }

            //如果是ie10 以上 不需要添加

            $(this).clone(true, true).insertAfter($(this));
        });
    }); 
</script>
</html>
